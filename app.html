<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clara AI - Pharmaceutical Intelligence Platform</title>
    <meta name="description" content="AI-powered pharmaceutical engagement platform for healthcare professionals">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.0/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <style>
        .hero-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .chat-bubble-user { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .response-card { background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); }
        
        @keyframes typing {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .typing-indicator { animation: typing 1.5s infinite; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        
        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans" x-data="claraApp()">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 p-2 rounded-lg">
                        <i class="fas fa-brain text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-800">Clara AI</h1>
                        <p class="text-sm text-gray-600">Pharmaceutical Intelligence</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <button @click="currentView = 'chat'" :class="currentView === 'chat' ? 'text-blue-600' : 'text-gray-600'" class="hover:text-blue-600 transition-colors">
                        <i class="fas fa-comments mr-2"></i>Chat
                    </button>
                    <button @click="currentView = 'analytics'" :class="currentView === 'analytics' ? 'text-blue-600' : 'text-gray-600'" class="hover:text-blue-600 transition-colors">
                        <i class="fas fa-chart-bar mr-2"></i>Analytics
                    </button>
                    <a href="/" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Chat View -->
    <div x-show="currentView === 'chat'" class="pt-20 min-h-screen">
        <!-- Header -->
        <section class="hero-gradient text-white py-8">
            <div class="max-w-4xl mx-auto text-center px-4">
                <h1 class="text-3xl font-bold mb-4">Clara AI Assistant</h1>
                <p class="text-lg mb-4">Your AI-powered pharmaceutical intelligence platform</p>
                <div class="flex flex-wrap justify-center gap-4 text-sm">
                    <span class="bg-white/20 px-3 py-1 rounded-full">Instant Responses</span>
                    <span class="bg-white/20 px-3 py-1 rounded-full">95% Accuracy</span>
                    <span class="bg-white/20 px-3 py-1 rounded-full">HIPAA Compliant</span>
                </div>
            </div>
        </section>

        <!-- Chat Interface -->
        <section class="py-8">
            <div class="max-w-4xl mx-auto px-4">
                <div class="response-card rounded-xl p-6 h-96 overflow-y-auto mb-6" id="chatContainer">
                    <!-- Welcome Message -->
                    <div x-show="messages.length === 0" class="text-center py-8">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg inline-block mb-4">
                            <i class="fas fa-robot text-2xl mb-2"></i>
                            <p class="font-semibold">Hello! I'm Clara, your AI pharmaceutical assistant.</p>
                        </div>
                        <p class="text-gray-600 mb-6">I can help with drug information, prior authorization, patient assistance programs, and clinical guidance.</p>
                        
                        <!-- Quick Start Buttons -->
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <button @click="sendSampleQuery('What is the standard dosing for Biktarvy?')" class="bg-blue-100 text-blue-800 p-3 rounded-lg hover:bg-blue-200 transition-colors text-sm">
                                <i class="fas fa-pills mb-1"></i><br>Drug Dosing
                            </button>
                            <button @click="sendSampleQuery('Help me with prior authorization for Descovy')" class="bg-green-100 text-green-800 p-3 rounded-lg hover:bg-green-200 transition-colors text-sm">
                                <i class="fas fa-file-medical mb-1"></i><br>Prior Auth
                            </button>
                            <button @click="sendSampleQuery('What patient assistance programs are available for Biktarvy?')" class="bg-purple-100 text-purple-800 p-3 rounded-lg hover:bg-purple-200 transition-colors text-sm">
                                <i class="fas fa-hand-holding-heart mb-1"></i><br>Patient Assistance
                            </button>
                            <button @click="sendSampleQuery('What are the drug interactions with Biktarvy?')" class="bg-orange-100 text-orange-800 p-3 rounded-lg hover:bg-orange-200 transition-colors text-sm">
                                <i class="fas fa-exclamation-triangle mb-1"></i><br>Interactions
                            </button>
                        </div>
                    </div>

                    <!-- Chat Messages -->
                    <div x-show="messages.length > 0">
                        <template x-for="(message, index) in messages" :key="index">
                            <div class="mb-4 slide-in">
                                <!-- User Message -->
                                <div x-show="message.type === 'user'" class="flex justify-end">
                                    <div class="chat-bubble-user text-white rounded-lg p-4 max-w-md">
                                        <p x-text="message.content"></p>
                                        <div class="text-xs text-blue-100 mt-2" x-text="formatTime(message.timestamp)"></div>
                                    </div>
                                </div>
                                
                                <!-- AI Response -->
                                <div x-show="message.type === 'ai'" class="flex justify-start">
                                    <div class="bg-white rounded-lg p-4 max-w-3xl border shadow-sm">
                                        <div class="flex items-center space-x-2 mb-3">
                                            <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-full">
                                                <i class="fas fa-robot text-white text-sm"></i>
                                            </div>
                                            <div>
                                                <span class="font-semibold text-gray-800">Clara AI</span>
                                                <div class="flex items-center space-x-3 text-xs text-gray-500">
                                                    <span x-show="message.confidence">
                                                        <i class="fas fa-check-circle text-green-500"></i>
                                                        Confidence: <span x-text="Math.round(message.confidence * 100)">95</span>%
                                                    </span>
                                                    <span x-show="message.responseTime">
                                                        <i class="fas fa-clock"></i>
                                                        <span x-text="message.responseTime">1.2</span>s
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="prose prose-sm max-w-none">
                                            <div x-html="formatResponse(message.content)"></div>
                                        </div>
                                        
                                        <!-- Suggested Actions -->
                                        <div x-show="message.suggestedActions && message.suggestedActions.length > 0" class="mt-4">
                                            <p class="text-sm font-medium text-gray-700 mb-2">Follow-up actions:</p>
                                            <div class="flex flex-wrap gap-2">
                                                <template x-for="action in message.suggestedActions">
                                                    <button @click="sendSampleQuery(action)" class="text-xs bg-blue-50 text-blue-700 px-3 py-1 rounded-full hover:bg-blue-100 transition-colors">
                                                        <span x-text="action"></span>
                                                    </button>
                                                </template>
                                            </div>
                                        </div>
                                        
                                        <!-- Feedback -->
                                        <div class="mt-4 pt-3 border-t flex items-center justify-between">
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xs text-gray-500">Helpful?</span>
                                                <button @click="submitFeedback(message.responseId, 5)" class="text-green-500 hover:text-green-600">
                                                    <i class="fas fa-thumbs-up"></i>
                                                </button>
                                                <button @click="submitFeedback(message.responseId, 2)" class="text-red-500 hover:text-red-600">
                                                    <i class="fas fa-thumbs-down"></i>
                                                </button>
                                            </div>
                                            <div class="text-xs text-gray-400" x-text="formatTime(message.timestamp)"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                        
                        <!-- Typing Indicator -->
                        <div x-show="isTyping" class="flex justify-start mb-4">
                            <div class="bg-white rounded-lg p-4 border shadow-sm">
                                <div class="flex items-center space-x-2">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 p-2 rounded-full">
                                        <i class="fas fa-robot text-white text-sm"></i>
                                    </div>
                                    <div class="flex space-x-1">
                                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator" style="animation-delay: 0.2s;"></div>
                                        <div class="w-2 h-2 bg-gray-400 rounded-full typing-indicator" style="animation-delay: 0.4s;"></div>
                                    </div>
                                    <span class="text-sm text-gray-500">Clara is thinking...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="response-card rounded-xl p-4">
                    <div class="flex space-x-4">
                        <input 
                            x-model="currentQuery"
                            @keydown.enter="sendMessage()"
                            type="text" 
                            placeholder="Ask Clara about drug information, prior authorization, or patient assistance..."
                            class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            :disabled="isTyping"
                        >
                        <button 
                            @click="sendMessage()"
                            :disabled="isTyping || !currentQuery.trim()"
                            class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <div class="mt-2 text-xs text-gray-500 flex items-center justify-between">
                        <span>Powered by Clara AI ‚Ä¢ HIPAA Compliant ‚Ä¢ Always Learning</span>
                        <div class="flex items-center space-x-4">
                            <span class="flex items-center space-x-1">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <span>Online</span>
                            </span>
                            <span x-show="sessionStats.queries > 0">
                                Session: <span x-text="sessionStats.queries"></span> queries
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Analytics View -->
    <div x-show="currentView === 'analytics'" class="pt-20 min-h-screen p-8">
        <div class="max-w-7xl mx-auto">
            <h2 class="text-3xl font-bold text-gray-800 mb-8">Analytics Dashboard</h2>
            
            <!-- Metrics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">Total Queries</h3>
                            <p class="text-2xl font-bold text-gray-900" x-text="analytics.totalQueries">0</p>
                        </div>
                        <div class="bg-blue-100 p-3 rounded-full">
                            <i class="fas fa-comments text-blue-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">Avg Confidence</h3>
                            <p class="text-2xl font-bold text-gray-900" x-text="Math.round(analytics.avgConfidence * 100) + '%'">95%</p>
                        </div>
                        <div class="bg-green-100 p-3 rounded-full">
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">Response Time</h3>
                            <p class="text-2xl font-bold text-gray-900" x-text="analytics.avgResponseTime + 's'">1.2s</p>
                        </div>
                        <div class="bg-purple-100 p-3 rounded-full">
                            <i class="fas fa-clock text-purple-600"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-sm font-medium text-gray-500">Satisfaction</h3>
                            <p class="text-2xl font-bold text-gray-900" x-text="analytics.satisfaction + '/5'">4.8/5</p>
                        </div>
                        <div class="bg-yellow-100 p-3 rounded-full">
                            <i class="fas fa-star text-yellow-600"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Charts placeholder -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Query Types</h3>
                    <canvas id="queryTypesChart" class="max-h-64"></canvas>
                </div>
                
                <div class="bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Popular Drugs</h3>
                    <canvas id="drugPopularityChart" class="max-h-64"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        function claraApp() {
            return {
                currentView: 'chat',
                messages: [],
                currentQuery: '',
                isTyping: false,
                sessionId: generateUUID(),
                sessionStats: { queries: 0 },
                analytics: {
                    totalQueries: 127,
                    avgConfidence: 0.952,
                    avgResponseTime: 1.2,
                    satisfaction: 4.8
                },
                
                async sendMessage() {
                    if (!this.currentQuery.trim()) return;
                    
                    const query = this.currentQuery.trim();
                    this.currentQuery = '';
                    
                    this.addMessage('user', query);
                    this.sessionStats.queries++;
                    
                    this.isTyping = true;
                    this.scrollToBottom();
                    
                    try {
                        const response = await this.callClaraAPI(query);
                        
                        setTimeout(() => {
                            this.isTyping = false;
                            this.addMessage('ai', response.response || this.getDefaultResponse(query), {
                                confidence: response.confidence_score || 0.95,
                                responseTime: response.response_time ? (response.response_time / 1000).toFixed(1) : '1.2',
                                responseId: response.response_id || generateUUID(),
                                suggestedActions: response.follow_up_suggestions || []
                            });
                            this.scrollToBottom();
                        }, 800);
                        
                    } catch (error) {
                        this.isTyping = false;
                        this.addMessage('ai', 'I apologize, but I\'m having trouble connecting to my backend right now. This is a demo interface - please try the sample queries below or contact support@advocaremed.com for assistance.');
                        this.scrollToBottom();
                    }
                },
                
                async sendSampleQuery(query) {
                    this.currentQuery = query;
                    await this.sendMessage();
                },
                
                async callClaraAPI(query) {
                    // Try to call the actual API, fall back to demo responses
                    try {
                        const API_URL = window.location.hostname === 'localhost' 
                            ? 'http://localhost:8000' 
                            : 'https://clara-api-production.up.railway.app';
                        
                        const response = await fetch(`${API_URL}/api/v1/query`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                query: query,
                                session_id: this.sessionId
                            })
                        });
                        
                        if (response.ok) {
                            return await response.json();
                        }
                    } catch (error) {
                        console.log('API call failed, using demo response');
                    }
                    
                    // Fallback to demo response
                    return {
                        response: this.getDefaultResponse(query),
                        confidence_score: 0.95,
                        response_time: 1200
                    };
                },
                
                getDefaultResponse(query) {
                    const q = query.toLowerCase();
                    
                    if (q.includes('biktarvy')) {
                        return `**Biktarvy (bictegravir/TAF/FTC) Clinical Information**

üîπ **Dosing:** One tablet once daily with or without food
üîπ **Key Interactions:** Avoid rifampin, carbamazepine; separate from antacids by 2+ hours
üîπ **Advantages:** High resistance barrier, minimal renal/bone effects
üîπ **Monitoring:** Baseline HIV RNA, CD4; watch for weight gain

**Insurance Coverage:** 89% commercial plans typically cover with proper documentation.

Would you like information about patient assistance programs or prior authorization requirements?`;
                    }
                    
                    if (q.includes('descovy') && q.includes('prior')) {
                        return `**Descovy Prior Authorization Support**

üìã **Common Requirements:**
‚Ä¢ Step therapy: Trial of generic TDF/FTC first
‚Ä¢ Medical necessity: Document renal/bone concerns
‚Ä¢ Provider qualification: HIV specialist preferred

üìù **Required Documentation:**
‚Ä¢ Current HIV viral load and CD4 count
‚Ä¢ Creatinine clearance results
‚Ä¢ Previous medication history

‚è±Ô∏è **Typical Timeline:** 3-5 business days
‚úÖ **Success Rate:** 89% with proper documentation

I can help you generate the PA letter with all required elements. Would you like me to create a template?`;
                    }
                    
                    if (q.includes('assistance') || q.includes('patient')) {
                        return `**Patient Assistance Programs Available**

üí≥ **Copay Cards:**
‚Ä¢ Reduce monthly costs to $10-15
‚Ä¢ Available for commercially insured patients
‚Ä¢ No income restrictions

üÜì **Free Drug Programs:**
‚Ä¢ 100% coverage for qualifying patients
‚Ä¢ Income requirements: ‚â§500% Federal Poverty Level
‚Ä¢ Uninsured or underinsured patients

üìû **Enrollment Support:**
‚Ä¢ Call 1-800-GILEAD-5
‚Ä¢ Online applications available
‚Ä¢ Average processing: 3-5 business days

Would you like help checking patient eligibility or starting an application?`;
                    }
                    
                    return `I can provide detailed pharmaceutical information including:

üîç **Drug Information:** Complete prescribing details, dosing, interactions
üìã **Prior Authorization:** Step-by-step guidance and documentation help
üí≥ **Patient Assistance:** Copay cards, free programs, and eligibility checking
üìñ **Clinical Guidelines:** Evidence-based treatment recommendations

Please ask me about a specific medication or clinical scenario, and I'll provide detailed, actionable information for your practice.`;
                },
                
                addMessage(type, content, metadata = {}) {
                    this.messages.push({
                        type,
                        content,
                        timestamp: new Date(),
                        ...metadata
                    });
                },
                
                formatResponse(response) {
                    return response
                        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>')
                        .replace(/üîπ|üìã|üíä|üîÑ|üìä|üí°|üìà|‚ö†Ô∏è|üéØ|üìù|‚è±Ô∏è|‚úÖ|üí≥|üÜì|üìû|üåê|üîç|üìñ/g, '<span class="text-blue-500">$&</span>');
                },
                
                formatTime(timestamp) {
                    return new Date(timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                },
                
                scrollToBottom() {
                    this.$nextTick(() => {
                        const container = document.getElementById('chatContainer');
                        container.scrollTop = container.scrollHeight;
                    });
                },
                
                submitFeedback(responseId, rating) {
                    console.log(`Feedback submitted: ${responseId} - ${rating}`);
                    // In production, send to analytics API
                }
            }
        }
        
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
    </script>
</body>
</html>